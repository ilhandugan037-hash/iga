<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turkcell WIDE HORIZON V14 | İlhan Dugan</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- GENİŞ VE FERAH TASARIM AYARLARI --- */
        :root {
            --bg-dark: #0f1115;
            --bg-panel: #1a1f26;
            --bg-hover: #252b36;
            --border: #353b45;
            --tc-blue: #004F9F;
            --tc-yellow: #FFC900;
            --text-main: #e6edf3;
            --text-sub: #9ca5b5; /* Daha parlak gri */
            --green: #2da44e;
            --red: #cf222e;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', 'Roboto', sans-serif; outline: none; }
        
        /* Font boyutu arttırıldı ve letter-spacing açıldı */
        body { background: var(--bg-dark); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; font-size: 15px; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }

        /* --- SIDEBAR (DAHA GENİŞ) --- */
        .sidebar { width: 290px; background: var(--bg-panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; z-index: 50; }
        .brand { height: 75px; background: white; border-bottom: 4px solid var(--tc-yellow); display: flex; align-items: center; justify-content: center; }
        .brand img { height: 36px; }
        
        .user-card { padding: 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 15px; background: rgba(255,255,255,0.03); }
        .avatar { width: 45px; height: 45px; background: var(--tc-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; border: 2px solid var(--tc-yellow); box-shadow: 0 0 10px rgba(0,79,159,0.5); }
        
        .menu-scroll { flex: 1; overflow-y: auto; padding: 15px 0; }
        .menu-header { font-size: 0.8rem; color: #777; padding: 15px 25px 8px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        .menu-item { padding: 14px 25px; cursor: pointer; display: flex; align-items: center; gap: 15px; color: var(--text-sub); transition: 0.2s; border-left: 4px solid transparent; font-size: 0.95rem; }
        .menu-item:hover, .menu-item.active { background: var(--bg-hover); color: white; border-left-color: var(--tc-yellow); }
        .menu-item i { width: 24px; text-align: center; font-size: 1.1rem; }
        .badge { background: var(--red); color: white; font-size: 0.75rem; padding: 2px 8px; border-radius: 6px; margin-left: auto; font-weight: bold; display: none; }

        /* --- MAIN LAYOUT --- */
        .main { flex: 1; display: flex; flex-direction: column; position: relative; }
        .top-bar { height: 65px; background: var(--bg-panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; }
        .page-title { font-weight: 600; font-size: 1.3rem; color: white; display: flex; align-items: center; gap: 15px; }

        .view-container { flex: 1; overflow: hidden; position: relative; }
        .view { display: none; height: 100%; flex-direction: column; padding: 0; animation: fadeEffect 0.2s; }
        .view.active { display: flex; }
        @keyframes fadeEffect { from { opacity: 0; } to { opacity: 1; } }

        /* --- DASHBOARD GRID (GENİŞLETİLMİŞ) --- */
        /* Listeyi ve Log alanını genişlettik, detay alanı ferahladı */
        .dash-grid { display: grid; grid-template-columns: 400px 1fr 350px; height: 100%; }
        
        /* COLUMN 1: LIST */
        .col-list { border-right: 1px solid var(--border); background: var(--bg-dark); display: flex; flex-direction: column; overflow: hidden; }
        .list-header { padding: 15px 20px; border-bottom: 1px solid var(--border); font-weight: bold; background: var(--bg-panel); display: flex; justify-content: space-between; align-items: center; font-size: 1rem; }
        .ticket-scroll { flex: 1; overflow-y: auto; }
        
        .ticket-card { padding: 18px 22px; border-bottom: 1px solid var(--border); cursor: pointer; transition: 0.1s; position: relative; }
        .ticket-card:hover { background: var(--bg-hover); }
        .ticket-card.selected { background: rgba(0, 79, 159, 0.2); border-left: 4px solid var(--tc-blue); }
        .t-top { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.85rem; color: var(--text-sub); }
        .t-title { font-weight: 600; color: #fff; margin-bottom: 5px; font-size: 1.05rem; }
        .t-sub { color: var(--text-sub); font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }
        .cat-badge { padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; background: #333; color: #ccc; }

        /* COLUMN 2: DETAIL */
        .col-detail { display: flex; flex-direction: column; overflow: hidden; background: #13171d; position: relative; }
        .detail-header { padding: 20px 30px; border-bottom: 1px solid var(--border); background: var(--bg-panel); display: flex; justify-content: space-between; align-items: center; }
        .detail-body { flex: 1; overflow-y: auto; padding: 30px; padding-bottom: 100px; }
        
        .user-statement-box { background: rgba(0,79,159,0.1); border-left: 5px solid var(--tc-blue); padding: 25px; margin-bottom: 30px; border-radius: 0 8px 8px 0; }
        .user-statement-text { font-size: 1.1rem; color: #e6edf3; font-style: italic; line-height: 1.6; }
        
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .info-card { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 15px; border-radius: 8px; }
        .lbl { font-size: 0.8rem; color: var(--text-sub); display: block; margin-bottom: 5px; text-transform: uppercase; }
        .val { font-size: 1.1rem; font-weight: 500; color: white; }

        .tools-panel { margin-top: 20px; border: 1px solid var(--border); border-radius: 8px; padding: 20px; background: rgba(255,255,255,0.02); }
        .tools-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px; }
        .tool-btn { background: var(--bg-panel); border: 1px solid var(--border); color: var(--text-main); padding: 15px; border-radius: 6px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; transition: 0.2s; font-size: 0.9rem; }
        .tool-btn:hover { background: var(--tc-blue); border-color: var(--tc-blue); transform: translateY(-2px); }
        .tool-btn i { font-size: 1.5rem; }

        .detail-footer { position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px 30px; background: var(--bg-panel); border-top: 1px solid var(--border); display: flex; gap: 20px; z-index: 10; box-shadow: 0 -10px 30px rgba(0,0,0,0.5); }
        .btn-big { flex: 1; padding: 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1.1rem; color: white; display: flex; align-items: center; justify-content: center; gap: 12px; transition: 0.2s; }
        .btn-blue { background: var(--tc-blue); } .btn-blue:hover { background: #003d7a; }
        .btn-green { background: var(--green); } .btn-green:hover { background: #1a6328; }

        /* COLUMN 3: LOGS */
        .col-logs { border-left: 1px solid var(--border); background: var(--bg-panel); display: flex; flex-direction: column; }
        .log-area { flex: 1; background: black; color: #0f0; font-family: 'Consolas', monospace; font-size: 0.9rem; padding: 20px; overflow-y: auto; line-height: 1.5; }

        /* GENERIC */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; background: rgba(0,0,0,0.3); color: var(--text-sub); font-weight: 600; }
        td { padding: 15px; border-bottom: 1px solid var(--border); vertical-align: middle; }
        .tag { padding: 5px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: 600; display: inline-block; }
        .tag-done { background: var(--green); color: white; }
        .tag-wait { background: #d29922; color: black; }
        .tag-proc { background: var(--tc-blue); color: white; animation: pulse 2s infinite; }

        /* SEARCH */
        .search-container { max-width: 900px; margin: 50px auto; width: 90%; }
        .inp-lg { width: 100%; padding: 20px; background: var(--bg-dark); border: 2px solid var(--border); color: white; font-size: 1.4rem; border-radius: 10px; margin-bottom: 25px; transition: 0.3s; }
        .inp-lg:focus { border-color: var(--tc-blue); }
        .res-card { background: var(--bg-panel); border: 1px solid var(--border); border-radius: 12px; padding: 35px; display: none; position: relative; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }

        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 200; display: none; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal-box { width: 600px; background: var(--bg-panel); border: 1px solid var(--border); border-radius: 12px; padding: 35px; box-shadow: 0 30px 80px black; }
        
        /* TOAST */
        .toast { position: fixed; top: 30px; right: 30px; background: var(--bg-panel); border-left: 5px solid var(--green); padding: 20px; width: 350px; transform: translateX(120%); transition: 0.4s; z-index: 300; box-shadow: 0 15px 40px black; display: flex; align-items: center; gap: 20px; }
        .toast.show { transform: translateX(0); }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="brand">
            <img src="https://logos-world.net/wp-content/uploads/2020/12/Turkcell-Logo.png" alt="Turkcell">
        </div>
        <div class="user-card">
            <div class="avatar">İD</div>
            <div>
                <div style="font-weight:bold; color:var(--tc-yellow); font-size:1.05rem;">İLHAN DUGAN</div>
                <div style="font-size:0.85rem; color:var(--text-sub)">Global Operations Director</div>
            </div>
        </div>
        
        <div class="menu-scroll">
            <div class="menu-header">OPERASYON MERKEZİ</div>
            <div class="menu-item active" onclick="nav('dash', this)"><i class="fas fa-satellite-dish"></i> Canlı Arıza Akışı</div>
            <div class="menu-item" onclick="nav('history', this)"><i class="fas fa-history"></i> İşlem Tarihçesi <div class="badge" id="badge-hist">0</div></div>

            <div class="menu-header">MÜŞTERİ YÖNETİMİ</div>
            <div class="menu-item" onclick="nav('sorgu', this)"><i class="fas fa-user-secret"></i> İstihbarat (Sorgu)</div>
            <div class="menu-item" onclick="nav('vip', this)"><i class="fas fa-crown"></i> VIP & Platinum</div>
            <div class="menu-item" onclick="nav('corp', this)"><i class="fas fa-building"></i> Kurumsal Çözüm</div>

            <div class="menu-header">ALTYAPI & NETWORK</div>
            <div class="menu-item" onclick="nav('fiber', this)"><i class="fas fa-network-wired"></i> Fiber Topoloji</div>
            <div class="menu-item" onclick="nav('base', this)"><i class="fas fa-broadcast-tower"></i> Baz İstasyonları</div>
            <div class="menu-item" onclick="nav('server', this)"><i class="fas fa-server"></i> Sunucu Odası</div>

            <div class="menu-header">FİNANS & İDARİ</div>
            <div class="menu-item" onclick="nav('finance', this)"><i class="fas fa-coins"></i> Finans & Tahsilat</div>
            <div class="menu-item" onclick="nav('security', this)"><i class="fas fa-shield-alt"></i> Güvenlik Logları</div>
            <div class="menu-item" onclick="nav('hr', this)"><i class="fas fa-users"></i> İK ve Vardiya</div>
        </div>
    </nav>

    <main class="main">
        <header class="top-bar">
            <div class="page-title" id="page-header"><i class="fas fa-satellite-dish"></i> Canlı Arıza Paneli</div>
            <div style="font-family:'Consolas'; color:var(--text-sub); font-size:1rem;">
                SYSTEM STATUS: <span style="color:var(--green)">OPTIMAL</span> | <span id="clock">12:00:00</span>
            </div>
        </header>

        <div class="view-container">

            <div id="dash" class="view active">
                <div class="dash-grid">
                    <div class="col-list">
                        <div class="list-header">
                            <span>Gelen Talepler</span>
                            <span id="t-count" style="background:var(--tc-blue); padding:4px 10px; border-radius:6px; font-size:0.9rem; color:white;">0</span>
                        </div>
                        <div class="ticket-scroll" id="ticket-list"></div>
                    </div>

                    <div class="col-detail" id="detail-view">
                        <div style="height:100%; display:flex; align-items:center; justify-content:center; flex-direction:column; color:var(--text-sub);">
                            <i class="fas fa-hand-pointer" style="font-size:4rem; margin-bottom:30px; opacity:0.3;"></i>
                            <p style="font-size:1.2rem;">Detayları görüntülemek için soldan bir talep seçin.</p>
                        </div>
                    </div>

                    <div class="col-logs">
                        <div class="list-header">Canlı Sistem Terminali</div>
                        <div class="log-area" id="terminal">
                            > System initialized successfully.<br>
                            > Wide Horizon UI loaded.<br>
                            > Connecting to Procedural Engine... [OK]<br>
                        </div>
                    </div>
                </div>
            </div>

            <div id="sorgu" class="view">
                <div class="search-container">
                    <h2 style="text-align:center; color:var(--tc-yellow); margin-bottom:30px; font-size:2rem;">YASAKLI BÖLGE: İSTİHBARAT</h2>
                    <input type="text" class="inp-lg" id="gsm-inp" placeholder="GSM No (5354653384) veya TCKN giriniz...">
                    <button class="btn-big btn-blue" style="width:100%; font-size:1.2rem;" onclick="searchUser()">VERİTABANI SORGULA</button>
                    <div id="search-res" class="res-card" style="margin-top:30px;"></div>
                </div>
            </div>

            <div id="history" class="view">
                <div style="padding:30px; overflow-y:auto; height:100%;">
                    <h2 style="margin-bottom:25px; color:white;">İşlem Geçmişi & Birim Geri Bildirimleri</h2>
                    <table id="hist-table">
                        <thead><tr><th>ID</th><th>Hedef Birim</th><th>Sorun Özeti</th><th>Durum</th><th>Birim Yanıtı</th><th>İşlem</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="vip" class="view"><div style="padding:30px; overflow-y:auto;"><h2>Platinum & Black Müşteri Listesi</h2><table id="vip-table" style="margin-top:20px;"><thead><tr><th>ID</th><th>Müşteri Adı</th><th>Paket</th><th>Ort. Harcama</th><th>Statü</th></tr></thead><tbody></tbody></table></div></div>
            <div id="corp" class="view"><div style="padding:30px; overflow-y:auto;"><h2>Kurumsal Hatlar & Arıza</h2><table style="margin-top:20px;"><thead><tr><th>Firma</th><th>Hizmet Tipi</th><th>Lokasyon</th><th>Durum</th></tr></thead><tbody><tr><td>Yemeksepeti HQ</td><td>Metro Ethernet</td><td>Levent</td><td><span class="tag tag-done">UP</span></td></tr><tr><td>Getir Depo</td><td>MPLS VPN</td><td>Tuzla</td><td><span class="tag tag-wait">DOWN</span></td></tr></tbody></table></div></div>
            <div id="server" class="view"><div style="padding:30px; display:grid; grid-template-columns:repeat(auto-fill, minmax(250px, 1fr)); gap:25px;" id="server-grid"></div></div>
            <div id="fiber" class="view"><div style="padding:30px;"><h2>Fiber Altyapı Haritası</h2><div id="fiber-map" style="height:600px; background:#111; border-radius:12px; margin-top:20px; position:relative; overflow:hidden;"></div></div></div>
            <div id="base" class="view"><div style="padding:30px;"><h2>Saha Kule Durumları</h2><table id="base-table" style="margin-top:20px;"><thead><tr><th>Kule ID</th><th>Bölge</th><th>Yük Durumu</th><th>Statü</th></tr></thead><tbody></tbody></table></div></div>
            <div id="finance" class="view"><div style="padding:30px;"><h2>Canlı Finans & Tahsilat Akışı</h2><div id="fin-log" class="log-area" style="height:600px; border-radius:12px; margin-top:20px;"></div></div></div>
            <div id="security" class="view"><div style="padding:30px;"><h2 style="color:var(--red)">Güvenlik & SOC Logları</h2><table id="sec-table" style="margin-top:20px;"><thead><tr><th>Zaman</th><th>IP Adresi</th><th>Tehdit Tipi</th><th>Aksiyon</th></tr></thead><tbody></tbody></table></div></div>
            <div id="hr" class="view"><div style="padding:30px;"><h2>Vardiya Listesi</h2><table style="margin-top:20px;"><thead><tr><th>Personel</th><th>Rol</th><th>Lokasyon</th><th>Durum</th></tr></thead><tbody><tr><td>İlhan Dugan</td><td>Yönetici</td><td>HQ</td><td style="color:var(--green)">Online</td></tr><tr><td>Ahmet Yılmaz</td><td>Tier 2</td><td>Plaza</td><td style="color:var(--green)">Online</td></tr></tbody></table></div></div>

        </div>
    </main>

    <div class="modal-overlay" id="route-modal">
        <div class="modal-box">
            <h3 style="color:var(--tc-yellow); margin-bottom:20px; font-size:1.5rem;">Departman Yönlendirme</h3>
            <p id="m-desc" style="color:#aaa; margin-bottom:20px; font-size:1rem;"></p>
            <label style="display:block; margin-bottom:10px; color:#ccc;">HEDEF BİRİM</label>
            <select id="m-dept" class="inp-lg" style="padding:15px; font-size:1rem; margin-bottom:20px;">
                <option>Saha Operasyonları (Field Ops)</option>
                <option>Core Network (Tier 2)</option>
                <option>Hukuk Departmanı</option>
                <option>Kurumsal Müşteri Hizmetleri</option>
                <option>Finans / Fatura İtiraz</option>
                <option>Dijital Servisler (TV+/BiP)</option>
            </select>
            <label style="display:block; margin-bottom:10px; color:#ccc;">TEKNİK NOT</label>
            <textarea id="m-note" class="inp-lg" style="height:100px; padding:15px; font-size:1rem; margin-bottom:25px;" placeholder="Sorun hakkında teknik detay..."></textarea>
            <div style="display:flex; gap:15px;">
                <button class="btn-big" style="background:#444;" onclick="closeModal()">İptal</button>
                <button class="btn-big btn-green" onclick="confirmRoute()">AKTAR</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        <div style="font-size:2rem; color:var(--green);"><i class="fas fa-check-circle"></i></div>
        <div>
            <div style="font-weight:bold; font-size:1.1rem; margin-bottom:5px;">Geri Bildirim Alındı</div>
            <div id="toast-msg" style="font-size:0.9rem; line-height:1.4;"></div>
        </div>
    </div>

    <script>
        // --- KATEGORİ BAZLI SORUN ÜRETİM MOTORU ---
        const fNames = ["Ahmet","Mehmet","Can","Zeynep","Elif","Selin","Burak","Mert","Emre","Ceren","Gizem","Pelin","Oğuz","Kaan","Murat","Hakan","Selin","Buse"];
        const lNames = ["Yılmaz","Kaya","Demir","Çelik","Şahin","Yıldız","Öztürk","Aydın","Arslan","Doğan","Koç","Kurt","Polat","Çakır","Erdoğan"];
        const locations = ["Kadıköy","Beşiktaş","Şişli","Üsküdar","Maltepe","Kartal","Pendik","Ümraniye","Ataşehir","Sancaktepe","Fatih","Beyoğlu","Bakırköy","Zeytinburnu","Sarıyer","Kağıthane","Esenyurt","Bağcılar","Küçükçekmece","Avcılar"];

        // Her kategori için ayrı kelime havuzları
        const scenarios = {
            GSM: {
                actions: ["tünele girerken","otobanda giderken","evde balkonda konuşurken","asansöre bindiğimde","bodrum kata inince"],
                errors: ["hat tamamen kopuyor","ses robotlaşıyor","arama düşüyor","karşı tarafı duyamıyorum","3G'ye düşüyor"],
                contexts: ["önemli bir görüşmedeydim","sürekli tekrar ediyor","cihazı yeni aldım","sim kartı değiştirdim ama düzelmedi"]
            },
            FIBER: {
                actions: ["akşam Netflix izlerken","oyun oynarken","Zoom toplantısında","dosya indirirken","modemi açıp kapatınca"],
                errors: ["hız 1Mbps oluyor","ping 500ms'e çıkıyor","LOS ışığı kırmızı yanıyor","Wi-Fi ağı kayboluyor","internet tamamen gidiyor"],
                contexts: ["kabloları kontrol ettim","modem çok ısınıyor","komşuda sorun yok","altyapı çalışması mı var?"]
            },
            BILL: {
                actions: ["faturamı incelerken","uygulamaya girince","mesaj gelince","otomatik ödeme talimatında"],
                errors: ["paket aşım ücreti gördüm","yurt dışı kullanımı yansımış","cayma bedeli çok yüksek","mükerrer ödeme alındı"],
                contexts: ["hattım kapalıydı","yurt dışına çıkmadım","taahhüdüm bitmemişti","iade talep ediyorum"]
            },
            APP: {
                actions: ["Paycell ile öderken","BiP'ten fotoğraf atarken","TV+ kutusunu açınca","fizy dinlerken","Lifebox yedeklemesinde"],
                errors: ["QR kod okumuyor","uygulama çöküyor","görüntü donuyor","şarkı listem silinmiş","yükleme hatası veriyor"],
                contexts: ["kasa sırasında kaldım","internetim var","son güncellemeden sonra oldu","hesabıma giremiyorum"]
            },
            CORP: {
                actions: ["VPN bağlantısı kurarken","Metro Ethernet hattında","sanal santralde","statik IP kullanımında"],
                errors: ["erişim tamamen kesildi","paket kaybı var","numaralar çalmıyor","portlar kapalı görünüyor"],
                contexts: ["tüm ofis internetsiz","üretim durdu","acil destek bekliyoruz","yedek devre devreye girmedi"]
            }
        };

        let tickets = [];
        let history = [];
        let selectedTicket = null;
        let idCounter = 12000;

        // --- INIT ---
        window.onload = () => {
            setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString(), 1000);
            
            // Başlangıç verisi
            for(let i=0; i<12; i++) generateTicket();
            
            // Loops
            setInterval(generateTicket, 3500); // Yeni talep
            setInterval(workflowLoop, 2000); // İş akışı
            
            // Modules
            initModules();
            log("Wide Horizon UI initialized.");
            log("Categorized RNG Engine active.");
        };

        // --- TICKET GENERATOR ---
        function generateTicket() {
            idCounter++;
            const cats = ["GSM", "FIBER", "BILL", "APP", "CORP"];
            const cat = cats[Math.floor(Math.random() * cats.length)];
            const pool = scenarios[cat];
            
            const act = pool.actions[Math.floor(Math.random() * pool.actions.length)];
            const err = pool.errors[Math.floor(Math.random() * pool.errors.length)];
            const ctx = pool.contexts[Math.floor(Math.random() * pool.contexts.length)];
            
            const desc = `${act}, ${err}. ${ctx}.`;
            const name = fNames[Math.floor(Math.random()*fNames.length)] + " " + lNames[Math.floor(Math.random()*lNames.length)];
            const loc = locations[Math.floor(Math.random()*locations.length)];

            let title = "Sorun Bildirimi";
            let icon = "fa-exclamation-circle";
            
            if(cat === "GSM") { title = "Şebeke / Ses Sorunu"; icon = "fa-signal"; }
            else if(cat === "FIBER") { title = "Ev İnterneti / Hız"; icon = "fa-wifi"; }
            else if(cat === "BILL") { title = "Fatura / Ücretlendirme"; icon = "fa-file-invoice-dollar"; }
            else if(cat === "APP") { title = "Dijital Servis Hatası"; icon = "fa-mobile-alt"; }
            else if(cat === "CORP") { title = "Kurumsal Altyapı"; icon = "fa-building"; }

            const t = {
                id: idCounter, cat, title, desc, name, loc, icon,
                time: new Date().toLocaleTimeString(),
                ip: `10.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`
            };

            tickets.unshift(t);
            if(tickets.length > 50) tickets.pop();
            renderList();
        }

        function renderList() {
            const el = document.getElementById('ticket-list');
            el.innerHTML = "";
            document.getElementById('t-count').innerText = tickets.length;
            
            tickets.forEach(t => {
                const div = document.createElement('div');
                div.className = `ticket-card ${selectedTicket && selectedTicket.id === t.id ? 'selected' : ''}`;
                div.onclick = () => showDetail(t);
                div.innerHTML = `
                    <div class="t-top"><span>#TRK-${t.id}</span><span>${t.time}</span></div>
                    <div class="t-title">${t.title}</div>
                    <div class="t-sub">
                        <span class="cat-badge">${t.cat}</span>
                        <i class="fas ${t.icon}"></i> ${t.name}
                    </div>
                `;
                el.appendChild(div);
            });
        }

        function showDetail(t) {
            selectedTicket = t;
            renderList();
            
            const el = document.getElementById('detail-view');
            el.innerHTML = `
                <div class="detail-header">
                    <div>
                        <h2 style="color:white; margin-bottom:5px;">#TRK-${t.id}</h2>
                        <div style="color:var(--text-sub); font-size:1rem;">${t.title}</div>
                    </div>
                    <div style="text-align:right;">
                         <span class="tag tag-proc">${t.cat}</span>
                    </div>
                </div>
                <div class="detail-body">
                    <div class="user-statement-box">
                        <div style="font-size:0.8rem; color:var(--tc-blue); font-weight:bold; margin-bottom:5px;">MÜŞTERİ BEYANI</div>
                        <div class="user-statement-text">"${t.desc}"</div>
                    </div>

                    <div class="info-grid">
                        <div class="info-card"><span class="lbl">Abone Adı</span><span class="val">${t.name}</span></div>
                        <div class="info-card"><span class="lbl">Lokasyon</span><span class="val">${t.loc}</span></div>
                        <div class="info-card"><span class="lbl">IP Adresi</span><span class="val">${t.ip}</span></div>
                        <div class="info-card"><span class="lbl">Cihaz</span><span class="val">iPhone 13 / iOS 17</span></div>
                    </div>

                    <div class="tools-panel">
                        <div style="font-weight:bold; color:var(--tc-yellow); margin-bottom:15px;">CANLI TEKNİK İŞLEMLER</div>
                        <div class="tools-grid">
                            <div class="tool-btn" onclick="runTool('Hat Reset')"><i class="fas fa-sync"></i><span>Hat Reset</span></div>
                            <div class="tool-btn" onclick="runTool('Port Kontrol')"><i class="fas fa-ethernet"></i><span>Port Kontrol</span></div>
                            <div class="tool-btn" onclick="runTool('Sinyal Güç')"><i class="fas fa-signal"></i><span>Sinyal Boost</span></div>
                        </div>
                    </div>
                </div>
                <div class="detail-footer">
                    <button class="btn-big btn-blue" onclick="openModal()"><i class="fas fa-share-square"></i> YÖNLENDİR</button>
                    <button class="btn-big btn-green" onclick="resolve()"><i class="fas fa-check-circle"></i> ÇÖZÜLDÜ</button>
                </div>
            `;
        }

        // --- WORKFLOW & HISTORY ---
        const replies = {
            "Saha Operasyonları": ["Saha ekibi müdahale etti, sorun giderildi.", "Baz istasyonu kart arızası onarıldı.", "Fiber kablo eki yenilendi."],
            "Core Network (Tier 2)": ["Profil resetlendi, hız normale döndü.", "IP bloğu temizlendi.", "Konfigürasyon hatası düzeltildi."],
            "Hukuk Departmanı": ["Talep incelendi, yasal süreç başlatıldı.", "Savcılık yazısına istinaden log verildi."],
            "Finans / Fatura İtiraz": ["Hatalı ücret iadesi yapıldı.", "Fatura detayları aboneye iletildi."],
            "Dijital Servisler (TV+/BiP)": ["Servis üyeliği yenilendi.", "Uygulama logları incelendi, bug fix yapıldı."]
        };

        function workflowLoop() {
            const now = Date.now();
            let updated = false;
            history.forEach(h => {
                if(h.status === "İşlemde" && (now - h.reqTime > 8000)) {
                    h.status = "Yanıtlandı";
                    const repList = replies[h.dept] || ["İşlem tamam."];
                    h.reply = repList[Math.floor(Math.random()*repList.length)];
                    showToast(h.dept, h.id);
                    updated = true;
                }
            });
            if(updated) renderHistory();
        }

        function renderHistory() {
            const tb = document.querySelector('#hist-table tbody');
            tb.innerHTML = "";
            let pending = 0;
            history.forEach((h, idx) => {
                if(h.status !== "Tamamlandı") pending++;
                let badge = h.status === "İşlemde" ? "tag-proc" : (h.status === "Yanıtlandı" ? "tag-done" : "tag-wait");
                let btn = h.status === "Yanıtlandı" ? `<button onclick="archive(${idx})" style="padding:5px 10px; background:var(--tc-blue); border:none; color:white; border-radius:4px; cursor:pointer;">Arşivle</button>` : `<i class="fas fa-clock" style="color:#555"></i>`;
                
                if(h.status === "Tamamlandı") { badge = "tag-wait"; btn = `<i class="fas fa-check" style="color:var(--green)"></i>`; }

                tb.innerHTML += `<tr><td>#${h.id}</td><td>${h.dept}</td><td>${h.title}</td><td><span class="tag ${badge}">${h.status}</span></td><td style="color:${h.status==='Yanıtlandı'?'var(--green)':'#777'}">${h.reply}</td><td>${btn}</td></tr>`;
            });
            const bg = document.getElementById('badge-hist');
            bg.innerText = pending;
            bg.style.display = pending > 0 ? 'inline-block' : 'none';
        }

        function openModal() { if(!selectedTicket)return; document.getElementById('m-desc').innerText=`#TRK-${selectedTicket.id} nolu talep için işlem başlatılıyor.`; document.getElementById('route-modal').style.display='flex'; }
        function closeModal() { document.getElementById('route-modal').style.display='none'; }
        
        function confirmRoute() {
            const dept = document.getElementById('m-dept').value;
            history.unshift({ id: selectedTicket.id, dept, title: selectedTicket.title, status: "İşlemde", reply: "-", reqTime: Date.now() });
            
            tickets = tickets.filter(t => t.id !== selectedTicket.id);
            selectedTicket = null;
            renderList();
            document.getElementById('detail-view').innerHTML = `<div style="height:100%; display:flex; align-items:center; justify-content:center; color:var(--green); flex-direction:column;"><i class="fas fa-check-circle" style="font-size:4rem; margin-bottom:15px;"></i><p>Talep Başarıyla Yönlendirildi</p></div>`;
            closeModal();
            renderHistory();
        }

        function archive(idx) { history[idx].status = "Tamamlandı"; renderHistory(); }
        function resolve() { if(!selectedTicket)return; alert('Kayıt kapatıldı.'); tickets=tickets.filter(t=>t.id!==selectedTicket.id); selectedTicket=null; renderList(); document.getElementById('detail-view').innerHTML=""; }

        // --- SORGU ---
        function searchUser() {
            const val = document.getElementById('gsm-inp').value.replace(/\s/g,'');
            const res = document.getElementById('search-res');
            res.style.display='none';
            if(val.length < 5) return alert("Numara giriniz");
            
            let d = {};
            if(val === "5354653384") { d = { n:"MEHMET DUGAN", t:"254********", dev:"Redmi 14C", loc:"İstanbul Kartal Soğanlık Yeni Mh. Eraykent Cd.", isTarget:true }; }
            else { d = { n: fNames[0]+" "+lNames[0], t:Math.floor(Math.random()*9e10), dev:"Samsung A54", loc:"İstanbul / Şişli", isTarget:false }; }
            
            setTimeout(() => {
                res.style.display = 'block';
                res.innerHTML = `
                    <div style="display:flex; gap:20px; align-items:center; border-bottom:1px solid var(--border); padding-bottom:20px; margin-bottom:20px;">
                        <div style="font-size:4rem; color:#555;"><i class="fas fa-user-circle"></i></div>
                        <div>
                            <h2 style="color:white; font-size:1.8rem;">${d.n}</h2>
                            <div style="font-family:'Consolas'; color:var(--tc-yellow); font-size:1.4rem;">${val}</div>
                            ${d.isTarget ? '<span style="background:var(--red); color:white; padding:3px 10px; border-radius:4px; font-size:0.8rem; font-weight:bold;">HEDEF TESPİT EDİLDİ</span>' : ''}
                        </div>
                    </div>
                    <div class="info-grid">
                        <div class="info-card"><span class="lbl">TCKN</span><span class="val">${d.t}</span></div>
                        <div class="info-card"><span class="lbl">Cihaz</span><span class="val">${d.dev}</span></div>
                        <div class="info-card" style="grid-column:span 2; border-color:${d.isTarget?'var(--red)':'var(--border)'}"><span class="lbl">Adres</span><span class="val" style="color:${d.isTarget?'var(--red)':'white'}">${d.loc}</span></div>
                    </div>`;
            }, 800);
        }

        // --- UTILS ---
        function nav(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('page-header').innerHTML = el.innerHTML;
        }
        function log(m) { const t=document.getElementById('terminal'); t.innerHTML+=`<div>> ${m}</div>`; t.scrollTop=t.scrollHeight; }
        function runTool(n) { log(`Running tool: ${n}...`); setTimeout(()=>log(`> ${n}: SUCCESS`),800); }
        function showToast(d, id) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerHTML = `<strong>${d}</strong><br>#TRK-${id} talebini yanıtladı.`;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 5000);
        }

        // --- INIT MODULES ---
        function initModules() {
            // VIP
            const vt = document.querySelector('#vip-table tbody');
            for(let i=0;i<10;i++) vt.innerHTML += `<tr><td>${100+i}</td><td>${fNames[i]} ${lNames[i]}</td><td>Platinum 100GB</td><td>${(Math.random()*5000).toFixed(2)} TL</td><td><span class="tag tag-proc" style="background:gold; color:black;">VIP</span></td></tr>`;
            
            // Server
            const sg = document.getElementById('server-grid');
            for(let i=1;i<=12;i++) sg.innerHTML += `<div style="background:rgba(255,255,255,0.05); padding:20px; border-radius:8px;"><div style="color:#777; font-size:0.9rem">NODE-${i}</div><div style="height:6px; background:#333; margin-top:10px;"><div style="width:${Math.random()*100}%; background:var(--tc-blue); height:100%"></div></div></div>`;

            // Fiber Map
            const fm = document.getElementById('fiber-map');
            for(let i=0;i<30;i++) fm.innerHTML += `<div style="position:absolute; top:${Math.random()*90}%; left:${Math.random()*90}%; width:8px; height:8px; background:cyan; border-radius:50%; box-shadow:0 0 8px cyan;"></div>`;

            // Base Table
            const bt = document.querySelector('#base-table tbody');
            for(let i=0;i<8;i++) bt.innerHTML += `<tr><td>IST-${900+i}</td><td>${locations[i]}</td><td>%${Math.floor(Math.random()*90)}</td><td><span class="tag tag-done">OK</span></td></tr>`;
            
            // Security
            const st = document.querySelector('#sec-table tbody');
            setInterval(() => {
                const r = `<tr><td>${new Date().toLocaleTimeString()}</td><td>192.168.1.${Math.floor(Math.random()*255)}</td><td style="color:var(--red)">DDoS Blocked</td><td>Auto-Ban</td></tr>`;
                st.innerHTML = r + st.innerHTML;
                if(st.children.length > 8) st.removeChild(st.lastChild);
            }, 2500);
            
             // Finance
            const fl = document.getElementById('fin-log');
            setInterval(() => { fl.innerHTML += `> Payment: ${Math.floor(Math.random()*1000)} TL received.<br>`; fl.scrollTop=fl.scrollHeight; }, 1200);
        }

    </script>
</body>
</html>
