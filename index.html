<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turkcell GRANDMASTER CRM | İlhan Dugan</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- CORE --- */
        :root {
            --bg-body: #0d1117;
            --bg-nav: #161b22;
            --bg-card: #21262d;
            --tc-blue: #004F9F;
            --tc-yellow: #FFC900;
            --text-main: #c9d1d9;
            --text-muted: #8b949e;
            --accent-green: #238636;
            --accent-red: #da3633;
            --border: #30363d;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }
        body { background: var(--bg-body); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; font-size: 14px; }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-body); }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

        /* --- SIDEBAR --- */
        .sidebar { width: 260px; background: var(--bg-nav); border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; }
        .brand { height: 65px; background: white; border-bottom: 3px solid var(--tc-yellow); display: flex; align-items: center; justify-content: center; }
        .brand img { height: 30px; }
        .user-panel { padding: 20px; border-bottom: 1px solid var(--border); background: rgba(255,255,255,0.03); }
        .u-name { color: var(--tc-yellow); font-weight: bold; font-size: 1.1rem; }
        .u-role { font-size: 0.8rem; color: var(--text-muted); margin-top: 3px; }
        
        .nav-menu { padding: 10px 0; flex: 1; overflow-y: auto; }
        .nav-item { padding: 12px 20px; cursor: pointer; display: flex; align-items: center; gap: 15px; color: var(--text-muted); transition: 0.2s; border-left: 3px solid transparent; }
        .nav-item:hover, .nav-item.active { background: rgba(0,79,159,0.2); color: white; border-left-color: var(--tc-yellow); }
        .nav-item i { width: 20px; text-align: center; }

        /* --- MAIN AREA --- */
        .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .header { height: 60px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 25px; background: var(--bg-nav); }
        .header-title { font-size: 1.2rem; font-weight: 600; color: white; display: flex; align-items: center; gap: 10px; }
        .status-indicators { display: flex; gap: 15px; font-size: 0.85rem; }
        .badge { padding: 4px 10px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; }

        /* --- VIEWS --- */
        .view { display: none; height: 100%; padding: 20px; flex-direction: column; }
        .view.active { display: flex; }

        /* --- DASHBOARD LAYOUT --- */
        .dash-container { display: flex; height: 100%; gap: 15px; }
        
        /* LIST PANEL */
        .list-panel { flex: 4; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; display: flex; flex-direction: column; overflow: hidden; }
        .panel-head { padding: 15px; border-bottom: 1px solid var(--border); font-weight: bold; background: rgba(0,0,0,0.2); display: flex; justify-content: space-between; align-items: center; }
        .ticket-list { flex: 1; overflow-y: auto; }
        
        .ticket-item { display: grid; grid-template-columns: 40px 60px 1fr 100px 80px; padding: 12px; border-bottom: 1px solid var(--border); cursor: pointer; align-items: center; transition: 0.1s; font-size: 0.9rem; }
        .ticket-item:hover { background: rgba(255,255,255,0.05); }
        .ticket-item.active { background: rgba(0,79,159,0.25); border-left: 3px solid var(--tc-blue); }
        
        .t-icon { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
        .icon-gsm { background: rgba(0,79,159,0.2); color: #4dabf7; }
        .icon-fiber { background: rgba(255,201,0,0.2); color: var(--tc-yellow); }
        .icon-tv { background: rgba(35,134,54,0.2); color: var(--accent-green); }

        /* DETAIL PANEL */
        .detail-panel { flex: 3; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; display: flex; flex-direction: column; overflow: hidden; }
        .empty-state { height: 100%; display: flex; align-items: center; justify-content: center; color: var(--text-muted); flex-direction: column; text-align: center; }
        
        .detail-tabs { display: flex; border-bottom: 1px solid var(--border); background: rgba(0,0,0,0.2); }
        .tab-btn { flex: 1; padding: 12px; text-align: center; cursor: pointer; color: var(--text-muted); transition: 0.2s; border-bottom: 2px solid transparent; }
        .tab-btn:hover { background: rgba(255,255,255,0.03); }
        .tab-btn.active { color: white; border-bottom-color: var(--tc-yellow); font-weight: bold; background: rgba(255,255,255,0.05); }
        
        .tab-content { padding: 20px; overflow-y: auto; flex: 1; display: none; }
        .tab-content.show { display: block; }
        
        .info-row { display: flex; justify-content: space-between; margin-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px; }
        .lbl { color: var(--text-muted); font-size: 0.85rem; }
        .val { color: white; font-weight: 500; font-family: 'Consolas', monospace; }

        .console-log { background: #000; color: #0f0; padding: 10px; font-family: 'Consolas', monospace; font-size: 0.8rem; height: 150px; overflow-y: auto; border-radius: 4px; border: 1px solid #333; margin-top: 15px; }

        .action-bar { padding: 15px; border-top: 1px solid var(--border); display: flex; gap: 10px; background: rgba(0,0,0,0.2); }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; color: white; transition: 0.2s; }
        .btn-blue { background: var(--tc-blue); } .btn-blue:hover { background: #003d7a; }
        .btn-green { background: var(--accent-green); } .btn-green:hover { background: #1a6328; }

        /* --- ABONE SORGU --- */
        .search-wrap { max-width: 600px; margin: 30px auto; width: 100%; }
        .search-inp { width: 100%; padding: 15px; background: #0d1117; border: 1px solid var(--border); color: white; font-size: 1.1rem; border-radius: 6px; margin-bottom: 15px; }
        .result-box { display: none; background: var(--bg-card); padding: 30px; border-radius: 12px; border: 1px solid var(--border); position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* --- HISTORY TABLE --- */
        .history-table { width: 100%; border-collapse: collapse; }
        .history-table th, .history-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); }
        .history-table th { background: rgba(0,0,0,0.2); color: var(--text-muted); }

        /* --- MODAL --- */
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 999; display: none; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .modal { width: 450px; background: var(--bg-nav); border: 1px solid var(--border); border-radius: 8px; padding: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
        .form-sel { width: 100%; padding: 10px; background: var(--bg-body); border: 1px solid var(--border); color: white; margin: 10px 0 20px 0; border-radius: 4px; }

    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="brand">
            <img src="https://logos-world.net/wp-content/uploads/2020/12/Turkcell-Logo.png" alt="Turkcell">
        </div>
        <div class="user-panel">
            <div class="u-name">İLHAN DUGAN</div>
            <div class="u-role">Operasyon Grup Müdürü</div>
            <div style="font-size:0.7rem; color:var(--accent-green); margin-top:5px;">● VPN: Secure (HQ)</div>
        </div>
        <div class="nav-menu">
            <div class="nav-item active" onclick="setView('dashboard', this)"><i class="fas fa-satellite-dish"></i> Canlı Operasyon</div>
            <div class="nav-item" onclick="setView('history', this)"><i class="fas fa-history"></i> Aktarılan İşler <span id="hist-badge" style="background:var(--tc-blue); font-size:0.7rem; padding:2px 6px; border-radius:4px; margin-left:auto; display:none;">0</span></div>
            <div class="nav-item" onclick="setView('sorgu', this)"><i class="fas fa-user-secret"></i> Yasaklı Bölge: Sorgu</div>
            <div class="nav-item" onclick="setView('chat', this)"><i class="fas fa-comments"></i> Saha Ekibi (Chat)</div>
            <div class="nav-item" onclick="setView('server', this)"><i class="fas fa-server"></i> Sunucu Odası</div>
        </div>
    </nav>

    <main class="main">
        <header class="header">
            <div class="header-title" id="page-title"><i class="fas fa-satellite-dish"></i> Canlı Operasyon Merkezi</div>
            <div class="status-indicators">
                <div class="badge"><i class="fas fa-database"></i> CRM: Online</div>
                <div class="badge"><i class="fas fa-network-wired"></i> Backbone: %42</div>
                <div class="badge" id="clock">12:00:00</div>
            </div>
        </header>

        <div id="dashboard" class="view active">
            <div class="dash-container">
                <div class="list-panel">
                    <div class="panel-head">
                        <span>Gelen Destek Talepleri</span>
                        <div style="font-size:0.8rem; color:var(--text-muted);">
                            Otomatik Yenileme: <span style="color:var(--accent-green)">AÇIK</span>
                        </div>
                    </div>
                    <div id="ticket-list-container" class="ticket-list">
                        </div>
                </div>

                <div class="detail-panel" id="detail-container">
                    <div class="empty-state">
                        <i class="fas fa-mouse-pointer" style="font-size:3rem; margin-bottom:20px; opacity:0.5;"></i>
                        <p>Detayları görüntülemek ve işlem yapmak için<br>soldaki listeden bir talep seçin.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="history" class="view">
            <div style="background:var(--bg-card); border:1px solid var(--border); border-radius:8px; padding:20px; flex:1; overflow-y:auto;">
                <h3 style="margin-bottom:20px; color:var(--tc-yellow);">Yönlendirilen İşler Logu</h3>
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Talep ID</th>
                            <th>Birim</th>
                            <th>Sorun</th>
                            <th>Abone</th>
                            <th>Zaman</th>
                            <th>Durum</th>
                        </tr>
                    </thead>
                    <tbody id="history-body">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="sorgu" class="view">
            <div class="search-wrap">
                <h2 style="text-align:center; margin-bottom:20px; color:var(--tc-yellow);">GELİŞMİŞ ABONE SORGULAMA (LEVEL 5)</h2>
                <input type="text" class="search-inp" id="gsmInput" placeholder="GSM No (5XX), TCKN veya Ad Soyad...">
                <button class="btn btn-blue" style="width:100%; font-size:1.1rem;" onclick="performSearch()">VERİTABANI SORGULA</button>

                <div id="loading" style="display:none; text-align:center; padding:40px;">
                    <i class="fas fa-circle-notch fa-spin" style="font-size:2rem; color:var(--tc-blue);"></i>
                    <p style="margin-top:10px; color:var(--text-muted);">Emniyet Genel Müdürlüğü & Nüfus İdaresi taranıyor...</p>
                </div>

                <div id="search-result" class="result-box" style="margin-top:20px;">
                    <div style="position:absolute; top:15px; right:15px; font-weight:bold; color:var(--accent-red); border:1px solid var(--accent-red); padding:3px 8px; font-size:0.7rem; transform:rotate(15deg);">TOP SECRET</div>
                    <div style="display:flex; align-items:center; gap:20px; margin-bottom:20px;">
                        <div style="width:70px; height:70px; background:#333; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:2rem;"><i class="fas fa-user"></i></div>
                        <div>
                            <h2 id="res-name" style="color:white;">-</h2>
                            <div id="res-gsm" style="color:var(--tc-yellow); font-family:'Consolas'; font-size:1.2rem;">-</div>
                        </div>
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                        <div class="info-row"><span class="lbl">TCKN:</span> <span class="val" id="res-tc">***</span></div>
                        <div class="info-row"><span class="lbl">Cihaz:</span> <span class="val" id="res-dev">-</span></div>
                        <div class="info-row"><span class="lbl">Segment:</span> <span class="val" id="res-seg">-</span></div>
                        <div class="info-row"><span class="lbl">Son Konum:</span> <span class="val" id="res-loc" style="color:var(--accent-green)">-</span></div>
                        <div class="info-row"><span class="lbl">Fatura:</span> <span class="val" id="res-debt">0.00 TL</span></div>
                        <div class="info-row"><span class="lbl">Kredi Puanı:</span> <span class="val" id="res-score">1400</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="chat" class="view">
            <div style="flex:1; background:var(--bg-card); border:1px solid var(--border); border-radius:8px; display:flex; flex-direction:column;">
                <div style="padding:15px; border-bottom:1px solid var(--border); font-weight:bold;">Saha Operasyon Ekibi (Canlı)</div>
                <div id="chat-msgs" style="flex:1; padding:20px; overflow-y:auto; display:flex; flex-direction:column; gap:10px;">
                    <div style="background:#2b313a; padding:10px; border-radius:6px; align-self:flex-start; max-width:70%;">Merkez, Avrupa Yakası fiber kesintisi için olay yerindeyiz. (Ali - Saha Şefi)</div>
                </div>
                <div style="padding:15px; border-top:1px solid var(--border); display:flex; gap:10px;">
                    <input type="text" id="chat-inp" style="flex:1; padding:10px; background:#0d1117; border:1px solid var(--border); color:white; border-radius:4px;" placeholder="Mesaj yaz...">
                    <button class="btn btn-blue" style="width:80px;" onclick="sendChat()"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>

        <div id="server" class="view">
            <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:20px;" id="server-grid">
                </div>
        </div>

    </main>

    <div class="modal-bg" id="modal">
        <div class="modal">
            <h3 style="color:var(--text-main); margin-bottom:5px;">Talebi Yönlendir</h3>
            <p style="color:var(--text-muted); font-size:0.9rem;">Talep ID: <span id="m-id" style="color:white;"></span></p>
            
            <label style="display:block; margin-top:15px; color:var(--text-muted); font-size:0.8rem;">HEDEF DEPARTMAN</label>
            <select class="form-sel" id="m-dept">
                <option>Saha Operasyonları (Field Ops)</option>
                <option>Core Network (Tier 2)</option>
                <option>Superonline Fiber Altyapı</option>
                <option>Kurumsal Çözüm Merkezi</option>
                <option>Hukuk / Regülasyon</option>
                <option>Müşteri Hizmetleri (Geri Dönüş)</option>
            </select>
            
            <label style="display:block; margin-top:5px; color:var(--text-muted); font-size:0.8rem;">NOTUNUZ</label>
            <textarea class="form-sel" style="height:80px;" placeholder="Teknik bulguları ekleyin..."></textarea>
            
            <div style="display:flex; gap:10px; justify-content:flex-end;">
                <button class="btn" style="background:transparent; border:1px solid #555;" onclick="closeModal()">İPTAL</button>
                <button class="btn btn-green" onclick="confirmRoute()">AKTAR</button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIG & STATE ---
        let selectedTicket = null;
        let tickets = [];
        let historyLog = [];
        let idCounter = 12000;

        // --- DATA POOLS (HUGE VARIETY) ---
        const ticketTypes = [
            { code: 'GSM', icon: 'fa-mobile-alt', color: 'icon-gsm', name: 'Mobil Şebeke' },
            { code: 'SOL', icon: 'fa-wifi', color: 'icon-fiber', name: 'Superonline Fiber' },
            { code: 'TVP', icon: 'fa-tv', color: 'icon-tv', name: 'TV+' },
            { code: 'CRP', icon: 'fa-building', color: 'icon-tv', name: 'Kurumsal' },
            { code: 'APP', icon: 'fa-fingerprint', color: 'icon-gsm', name: 'Dijital Servisler' }
        ];

        const locations = ["İstanbul/Şişli", "İstanbul/Kadıköy", "İstanbul/Beşiktaş", "Ankara/Çankaya", "İzmir/Bornova", "Bursa/Nilüfer", "Antalya/Konyaaltı", "Trabzon/Ortahisar", "Gaziantep/Şehitkamil", "Muğla/Bodrum"];
        const segments = ["Platinum Black", "Platinum", "GNÇ", "Kamu", "Esnaf", "Kurumsal Gold", "Bireysel"];
        
        // Massive Issue List
        const issuesDB = {
            GSM: [
                "Sinyal Yok (Tünel/Metro)", "4.5G Hız Düşüklüğü", "VoLTE Kayıt Hatası", "Konuşma Kesilmesi (Drop)", "Yurt Dışı Roaming Hatası", "SIM Kart Bloke (PUK)", 
                "Baz İstasyonu Alarmı", "SMS Teslim Edilmiyor", "Arama Yapılamıyor (Call Fail)", "Hücresel Veri Kopuyor"
            ],
            SOL: [
                "LOS Işığı Kırmızı Yanıyor", "WAN IP Alamıyor", "Modem Wi-Fi Kopuyor", "Fiber Kablo Kesik Şüphesi", "Oyunlarda Yüksek Ping (Latency)", "Hız Testi Düşük (1000Mbps)", 
                "Statik IP Tanımlama Hatası", "Port Yönlendirme Sorunu", "DNS Çözümleme Hatası", "Modem Yazılım Güncelleme"
            ],
            TVP: [
                "Siyah Ekran Hatası", "Kutu Açılmıyor", "HDCP Hatası (HDMI)", "Canlı Yayın Donuyor", "Geriye Sarma Çalışmıyor", "Kumanda Eşleşme Hatası", 
                "EPG Bilgisi Yüklenmiyor", "Film Kiralama Hatası", "Ses Senkron Sorunu", "Kanal Listesi Boş"
            ],
            CRP: [
                "VPN Tünel Down", "Metro Ethernet Kesintisi", "PABX Santral Jitter", "Bulut Santral Erişim", "Toplu SMS Gönderim Hatası", "Statik IP Blacklist", 
                "Fatura Limit Aşımı Uyarısı", "Kurumsal AP Pasif", "Yedek Devre Devreye Girmedi", "B2B Portal Erişim Hatası"
            ],
            APP: [
                "BiP Bildirim Gelmiyor", "Paycell Bakiye Yükleme Hatası", "fizy Müzik Çalmıyor", "Lifebox Yedekleme Durdu", "Dergilik Abonelik İptali", 
                "GollerCepte Video Açılmıyor", "Platinum Şifre Alamıyor", "Hesabım Uygulaması Login Hatası", "Sim Menü Güncelleme", "Mobil İmza Çalışmıyor"
            ]
        };

        const firstNames = ["Ahmet", "Mehmet", "Ayşe", "Fatma", "Can", "Burak", "Selin", "Zeynep", "Murat", "Elif", "Cem", "Deniz", "Efe", "Gökhan", "Hakan"];
        const lastNames = ["Yılmaz", "Kaya", "Demir", "Çelik", "Şahin", "Öztürk", "Arslan", "Doğan", "Kılıç", "Aslan", "Çetin", "Kara", "Koç", "Kurt"];

        // --- INIT ---
        window.onload = function() {
            startClock();
            // Generate Initial Data (20 tickets)
            for(let i=0; i<15; i++) createTicket(); 
            // Auto-Generate Loop
            setInterval(createTicket, 4000); 
            // Render Server Room
            renderServers();
        };

        // --- NAVIGATION ---
        function setView(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            
            const titles = {
                'dashboard': '<i class="fas fa-satellite-dish"></i> Canlı Operasyon Merkezi',
                'history': '<i class="fas fa-history"></i> İşlem Geçmişi ve Loglar',
                'sorgu': '<i class="fas fa-user-secret"></i> Yasaklı Bölge: Abone Sorgu',
                'chat': '<i class="fas fa-comments"></i> Saha Ekibi İletişim',
                'server': '<i class="fas fa-server"></i> Sunucu ve Altyapı İzleme'
            };
            document.getElementById('page-title').innerHTML = titles[id];
        }

        // --- TICKET LOGIC ---
        function createTicket() {
            idCounter++;
            const type = ticketTypes[Math.floor(Math.random() * ticketTypes.length)];
            const issueList = issuesDB[type.code];
            const issue = issueList[Math.floor(Math.random() * issueList.length)];
            const loc = locations[Math.floor(Math.random() * locations.length)];
            const name = firstNames[Math.floor(Math.random() * firstNames.length)] + " " + lastNames[Math.floor(Math.random() * lastNames.length)];
            const segment = segments[Math.floor(Math.random() * segments.length)];

            const t = {
                id: idCounter,
                type: type,
                issue: issue,
                loc: loc,
                name: name,
                segment: segment,
                time: new Date().toLocaleTimeString(),
                ip: `10.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,
                gsm: `53${Math.floor(Math.random()*9)} ${Math.floor(Math.random()*899)+100} ${Math.floor(Math.random()*89)+10} ${Math.floor(Math.random()*89)+10}`
            };

            tickets.unshift(t);
            if(tickets.length > 100) tickets.pop(); // Keep memory clean
            renderList();
        }

        function renderList() {
            const container = document.getElementById('ticket-list-container');
            container.innerHTML = "";
            tickets.forEach(t => {
                const div = document.createElement('div');
                div.className = `ticket-item ${selectedTicket && selectedTicket.id === t.id ? 'active' : ''}`;
                div.onclick = () => selectTicket(t);
                div.innerHTML = `
                    <div class="t-icon ${t.type.color}"><i class="fas ${t.type.icon}"></i></div>
                    <div style="font-family:'Consolas'; font-weight:bold;">#${t.id}</div>
                    <div>
                        <div style="font-weight:600; color:#e6edf3;">${t.issue}</div>
                        <div style="font-size:0.8rem; color:#8b949e;">${t.name} • ${t.loc}</div>
                    </div>
                    <div><span class="badge" style="font-size:0.75rem;">${t.type.name}</span></div>
                    <div style="text-align:right; font-size:0.75rem; color:#8b949e;">${t.time}</div>
                `;
                container.appendChild(div);
            });
        }

        function selectTicket(t) {
            selectedTicket = t;
            renderList(); // Update active highlight
            
            const detail = document.getElementById('detail-container');
            detail.innerHTML = `
                <div style="padding:20px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <h2 style="color:var(--tc-yellow);">#TRK-${t.id}</h2>
                        <h4 style="margin-top:5px;">${t.issue}</h4>
                    </div>
                    <div style="text-align:right;">
                        <div class="badge" style="background:var(--tc-blue); color:white; border:none;">${t.segment}</div>
                    </div>
                </div>
                
                <div class="detail-tabs">
                    <div class="tab-btn active" onclick="switchTab(event, 'tab-info')">Genel Bilgi</div>
                    <div class="tab-btn" onclick="switchTab(event, 'tab-tech')">Teknik Veriler</div>
                    <div class="tab-btn" onclick="switchTab(event, 'tab-hist')">Müşteri Geçmişi</div>
                </div>

                <div id="tab-info" class="tab-content show">
                    <div class="info-row"><span class="lbl">Müşteri Adı:</span> <span class="val">${t.name}</span></div>
                    <div class="info-row"><span class="lbl">GSM No:</span> <span class="val">${t.gsm}</span></div>
                    <div class="info-row"><span class="lbl">Lokasyon:</span> <span class="val">${t.loc}</span></div>
                    <div class="info-row"><span class="lbl">Hizmet Tipi:</span> <span class="val">${t.type.name}</span></div>
                    <div style="margin-top:20px; padding:15px; background:rgba(255,201,0,0.1); border-left:4px solid var(--tc-yellow); color:#e6edf3; font-style:italic;">
                        "Müşteri hizmeti kullanırken aniden kesinti yaşadığını, cihazı kapatıp açtığını ancak düzelmediğini beyan etmektedir."
                    </div>
                </div>

                <div id="tab-tech" class="tab-content">
                    <div class="info-row"><span class="lbl">IP Adresi:</span> <span class="val">${t.ip}</span></div>
                    <div class="info-row"><span class="lbl">MAC/IMEI:</span> <span class="val">AA:BB:CC:${Math.floor(Math.random()*99)}:${Math.floor(Math.random()*99)}</span></div>
                    <div class="info-row"><span class="lbl">Sinyal Seviyesi:</span> <span class="val" style="color:${Math.random()>0.5?'#7ee787':'#da3633'}">-${Math.floor(Math.random()*50)+50} dBm</span></div>
                    <div class="info-row"><span class="lbl">Node ID:</span> <span class="val">IST-POP-${Math.floor(Math.random()*900)}</span></div>
                    <div class="console-log">
> Initiating diagnostics...
> Pinging ${t.ip}... Reply (42ms)
> Checking Auth Server... [OK]
> Querying Profile... [OK]
> Last Error Code: ERR_TIMEOUT_GWAY
> Warning: High latency detected at hop 3.
                    </div>
                </div>

                <div id="tab-hist" class="tab-content">
                    <table style="width:100%; font-size:0.85rem; color:#ccc;">
                        <tr><td style="padding:5px;">12.11.2024</td><td>Fatura İtirazı</td><td style="color:#7ee787">Çözüldü</td></tr>
                        <tr><td style="padding:5px;">05.09.2024</td><td>Paket Değişikliği</td><td style="color:#7ee787">Tamamlandı</td></tr>
                        <tr><td style="padding:5px;">22.01.2024</td><td>Sinyal Sorunu</td><td style="color:#da3633">Tekrar Etti</td></tr>
                    </table>
                </div>

                <div class="action-bar">
                    <button class="btn btn-blue" onclick="openModal()">YÖNLENDİR / AKTAR</button>
                    <button class="btn btn-green" onclick="resolveTicket()">ÇÖZÜLDÜ KAPAT</button>
                </div>
            `;
        }

        function switchTab(e, id) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('show'));
            document.getElementById(id).classList.add('show');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
        }

        // --- ROUTING LOGIC ---
        function openModal() {
            if(!selectedTicket) return;
            document.getElementById('m-id').innerText = "#TRK-" + selectedTicket.id;
            document.getElementById('modal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        
        function confirmRoute() {
            const dept = document.getElementById('m-dept').value;
            // Add to history
            historyLog.unshift({
                id: selectedTicket.id,
                dept: dept,
                issue: selectedTicket.issue,
                name: selectedTicket.name,
                time: new Date().toLocaleTimeString(),
                status: 'İşlemde'
            });
            updateHistoryBadge();
            renderHistory();
            
            // Remove from main list
            tickets = tickets.filter(t => t.id !== selectedTicket.id);
            selectedTicket = null;
            renderList();
            document.getElementById('detail-container').innerHTML = `<div class="empty-state"><i class="fas fa-check-circle" style="font-size:3rem; color:var(--accent-green); margin-bottom:10px;"></i><p>Talep Başarıyla Aktarıldı.</p></div>`;
            closeModal();
        }

        function resolveTicket() {
            if(!selectedTicket) return;
            alert(`Talep #${selectedTicket.id} başarıyla çözüldü.`);
            tickets = tickets.filter(t => t.id !== selectedTicket.id);
            selectedTicket = null;
            renderList();
            document.getElementById('detail-container').innerHTML = `<div class="empty-state"><p>Talep Kapatıldı.</p></div>`;
        }

        function renderHistory() {
            const tbody = document.getElementById('history-body');
            tbody.innerHTML = "";
            historyLog.forEach(h => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>#${h.id}</td><td>${h.dept}</td><td>${h.issue}</td><td>${h.name}</td><td>${h.time}</td><td><span class="badge" style="background:#d29922; border:none; color:black;">${h.status}</span></td>`;
                tbody.appendChild(tr);
            });
        }
        function updateHistoryBadge() {
            const b = document.getElementById('hist-badge');
            b.innerText = historyLog.length;
            b.style.display = 'inline-block';
        }

        // --- ABONE SORGU ---
        function performSearch() {
            const inp = document.getElementById('gsmInput').value;
            if(inp.length < 3) { alert('Geçerli bir veri giriniz'); return; }
            
            document.getElementById('search-result').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('search-result').style.display = 'block';
                
                const names = ["İlhan Dugan", "Ayşe Yılmaz", "Mehmet Demir", "Ali Kaya", "Zeynep Çelik"];
                const devs = ["iPhone 14 Pro", "Samsung S23 Ultra", "Xiaomi 13T", "Huawei P60 Pro"];
                
                document.getElementById('res-name').innerText = names[Math.floor(Math.random()*names.length)];
                document.getElementById('res-gsm').innerText = inp;
                document.getElementById('res-tc').innerText = Math.floor(Math.random()*89999999999)+10000000000;
                document.getElementById('res-dev').innerText = devs[Math.floor(Math.random()*devs.length)];
                document.getElementById('res-seg').innerText = segments[Math.floor(Math.random()*segments.length)];
                document.getElementById('res-loc').innerText = locations[Math.floor(Math.random()*locations.length)];
                document.getElementById('res-debt').innerText = (Math.random()*1500).toFixed(2) + " TL";
            }, 1500);
        }

        // --- SERVER ---
        function renderServers() {
            const grid = document.getElementById('server-grid');
            for(let i=1; i<=12; i++) {
                grid.innerHTML += `
                    <div style="background:var(--bg-card); border:1px solid var(--border); padding:15px; border-radius:6px; position:relative;">
                        <div style="position:absolute; top:15px; right:15px; width:8px; height:8px; background:var(--accent-green); border-radius:50%; box-shadow:0 0 10px var(--accent-green);"></div>
                        <div style="font-weight:bold; color:white;">RACK-${100+i}</div>
                        <div style="font-size:0.8rem; color:var(--text-muted);">CPU Load</div>
                        <div style="height:4px; background:#333; margin-top:5px; border-radius:2px;"><div style="width:${Math.random()*100}%; background:var(--tc-blue); height:100%;"></div></div>
                        <div style="font-size:0.8rem; color:var(--text-muted); margin-top:5px;">Temp: ${Math.floor(Math.random()*15)+18}°C</div>
                    </div>
                `;
            }
        }
        
        // --- CHAT ---
        function sendChat() {
            const inp = document.getElementById('chat-inp');
            if(!inp.value) return;
            const area = document.getElementById('chat-msgs');
            area.innerHTML += `<div style="background:var(--tc-blue); padding:10px; border-radius:6px; align-self:flex-end; max-width:70%; color:white;">${inp.value}</div>`;
            inp.value = "";
            area.scrollTop = area.scrollHeight;
            setTimeout(() => {
                area.innerHTML += `<div style="background:#2b313a; padding:10px; border-radius:6px; align-self:flex-start; max-width:70%;">Anlaşıldı, yönlendiriyorum.</div>`;
                area.scrollTop = area.scrollHeight;
            }, 1000);
        }

        function startClock() {
            setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString(), 1000);
        }

    </script>
</body>
</html>
