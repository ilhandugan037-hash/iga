<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turkcell OMNIPOTENT V13 | İlhan Dugan</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- CORE VISUALS --- */
        :root { --bg-dark: #0d1117; --bg-panel: #161b22; --border: #30363d; --tc-blue: #004F9F; --tc-yellow: #FFC900; --text: #c9d1d9; --green: #238636; --red: #da3633; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg-dark); color: var(--text); display: flex; height: 100vh; overflow: hidden; font-size: 13px; }
        ::-webkit-scrollbar { width: 5px; } ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

        /* --- LAYOUT --- */
        .sidebar { width: 260px; background: var(--bg-panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .main { flex: 1; display: flex; flex-direction: column; position: relative; }
        .top-bar { height: 50px; background: var(--bg-panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }

        /* --- SIDEBAR ITEMS --- */
        .brand { height: 60px; background: white; display: flex; align-items: center; justify-content: center; border-bottom: 3px solid var(--tc-yellow); }
        .brand img { height: 28px; }
        .user-box { padding: 15px; border-bottom: 1px solid var(--border); display: flex; gap: 10px; align-items: center; background: rgba(255,255,255,0.02); }
        .avatar { width: 35px; height: 35px; background: var(--tc-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid var(--tc-yellow); }
        .menu { flex: 1; overflow-y: auto; padding: 10px 0; }
        .m-header { font-size: 0.7rem; color: #666; padding: 15px 20px 5px; font-weight: bold; text-transform: uppercase; }
        .m-item { padding: 10px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; color: #8b949e; transition: 0.2s; border-left: 3px solid transparent; }
        .m-item:hover, .m-item.active { background: #1f242c; color: white; border-left-color: var(--tc-yellow); }
        .badge { background: var(--red); color: white; font-size: 0.7rem; padding: 1px 6px; border-radius: 4px; margin-left: auto; display: none; }

        /* --- DASHBOARD GRID --- */
        .view { display: none; height: 100%; } .view.active { display: flex; }
        .grid-3 { display: grid; grid-template-columns: 350px 1fr 300px; height: 100%; }
        
        /* COLUMN STYLES */
        .col { display: flex; flex-direction: column; overflow: hidden; border-right: 1px solid var(--border); background: var(--bg-dark); }
        .col-header { padding: 10px 15px; background: var(--bg-panel); border-bottom: 1px solid var(--border); font-weight: bold; display: flex; justify-content: space-between; }
        
        /* TICKET CARD */
        .ticket { padding: 12px 15px; border-bottom: 1px solid var(--border); cursor: pointer; transition: 0.1s; position: relative; }
        .ticket:hover { background: #1c2128; }
        .ticket.selected { background: rgba(0,79,159,0.15); border-left: 3px solid var(--tc-blue); }
        .t-row { display: flex; justify-content: space-between; margin-bottom: 3px; font-size: 0.8rem; color: #8b949e; }
        .t-title { color: white; font-weight: 600; font-size: 0.95rem; margin-bottom: 2px; }

        /* DETAIL PANEL */
        .detail-content { padding: 20px; overflow-y: auto; flex: 1; padding-bottom: 80px; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .info-box { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 10px; border-radius: 5px; }
        .lbl { font-size: 0.7rem; color: #8b949e; display: block; }
        .val { font-size: 0.95rem; font-weight: 500; color: white; }
        
        /* ACTION FOOTER */
        .actions { padding: 15px; background: var(--bg-panel); border-top: 1px solid var(--border); display: flex; gap: 10px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; transition: 0.2s; }
        .btn-blue { background: var(--tc-blue); } .btn-blue:hover { background: #003d7a; }
        .btn-green { background: var(--green); } .btn-green:hover { background: #1a6328; }
        
        /* TERMINAL */
        .terminal { background: #000; color: #0f0; font-family: 'Consolas', monospace; padding: 15px; overflow-y: auto; flex: 1; font-size: 0.8rem; }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #222; padding-bottom: 2px; }

        /* TABLES */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px; background: rgba(0,0,0,0.3); color: #8b949e; }
        td { padding: 12px; border-bottom: 1px solid var(--border); }
        .status { padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; display: inline-block; }
        .st-wait { background: #d29922; color: #000; }
        .st-proc { background: var(--tc-blue); color: #fff; animation: pulse 1.5s infinite; }
        .st-done { background: var(--green); color: #fff; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        /* SEARCH */
        .search-box { max-width: 700px; margin: 40px auto; }
        .inp { width: 100%; padding: 15px; background: #0d1117; border: 1px solid var(--border); color: white; font-size: 1.2rem; border-radius: 5px; margin-bottom: 15px; }
        .res-card { background: var(--bg-panel); border: 1px solid var(--border); border-radius: 10px; padding: 25px; display: none; position: relative; }
        .target-badge { position: absolute; top: 0; right: 0; background: var(--red); color: white; padding: 5px 15px; font-weight: bold; border-bottom-left-radius: 10px; font-size: 0.8rem; }

        /* MODAL */
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; display: none; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .modal { width: 450px; background: var(--bg-panel); border: 1px solid var(--border); border-radius: 8px; padding: 25px; box-shadow: 0 20px 50px black; }
        
        /* TOAST */
        .toast { position: fixed; top: 20px; right: 20px; background: var(--bg-panel); border-left: 4px solid var(--green); padding: 15px; width: 300px; transform: translateX(120%); transition: 0.3s; z-index: 200; box-shadow: 0 10px 30px black; display: flex; align-items: center; gap: 15px; }
        .toast.show { transform: translateX(0); }

        /* TOOLS */
        .tools-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .tool-btn { background: #1f242c; border: 1px solid var(--border); color: #ccc; padding: 8px; text-align: center; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
        .tool-btn:hover { background: var(--tc-blue); color: white; }

    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="brand"><img src="https://logos-world.net/wp-content/uploads/2020/12/Turkcell-Logo.png"></div>
        <div class="user-box">
            <div class="avatar">İD</div>
            <div><div style="font-weight:bold; color:var(--tc-yellow)">İLHAN DUGAN</div><div style="font-size:0.75rem; color:#777">Operasyon Direktörü</div></div>
        </div>
        <div class="menu">
            <div class="m-header">ANA MODÜLLER</div>
            <div class="m-item active" onclick="nav('dash', this)"><i class="fas fa-th-large"></i> Canlı Arıza Akışı</div>
            <div class="m-item" onclick="nav('history', this)"><i class="fas fa-history"></i> İşlem Geçmişi <div class="badge" id="badge-hist">0</div></div>
            
            <div class="m-header">İSTİHBARAT & MÜŞTERİ</div>
            <div class="m-item" onclick="nav('sorgu', this)"><i class="fas fa-user-secret"></i> Yasaklı Bölge (Sorgu)</div>
            <div class="m-item" onclick="nav('vip', this)"><i class="fas fa-crown"></i> VIP Müşteri Listesi</div>
            <div class="m-item" onclick="nav('corp', this)"><i class="fas fa-building"></i> Kurumsal Hatlar</div>

            <div class="m-header">TEKNİK ALTYAPI</div>
            <div class="m-item" onclick="nav('fiber', this)"><i class="fas fa-network-wired"></i> Fiber Omurga</div>
            <div class="m-item" onclick="nav('base', this)"><i class="fas fa-broadcast-tower"></i> Saha Kuleleri</div>
            <div class="m-item" onclick="nav('server', this)"><i class="fas fa-server"></i> Sunucu Odası</div>
            
            <div class="m-header">YÖNETİM</div>
            <div class="m-item" onclick="nav('finance', this)"><i class="fas fa-coins"></i> Finans & Tahsilat</div>
            <div class="m-item" onclick="nav('security', this)"><i class="fas fa-shield-alt"></i> Güvenlik Logları</div>
        </div>
    </nav>

    <main class="main">
        <header class="top-bar">
            <div style="font-weight:600; font-size:1.1rem; color:white;" id="pg-title"><i class="fas fa-th-large"></i> Canlı Arıza Akışı</div>
            <div style="font-family:'Consolas'; color:#777;">SYSTEM: <span style="color:var(--green)">ONLINE</span> | <span id="clock">12:00</span></div>
        </header>

        <div id="dash" class="view active">
            <div class="grid-3">
                <div class="col">
                    <div class="col-header"><span>Gelen Talepler</span><span id="cnt-ticket" style="background:var(--tc-blue); padding:0 6px; border-radius:4px; font-size:0.8rem; color:white;">0</span></div>
                    <div style="overflow-y:auto; flex:1;" id="list-area"></div>
                </div>
                <div class="col" style="background:#0d1117;">
                    <div class="col-header"><span>Talep Detayı</span><span id="det-id" style="color:var(--tc-yellow); font-family:'Consolas'">-</span></div>
                    <div id="detail-area" style="flex:1; display:flex; flex-direction:column;">
                        <div style="flex:1; display:flex; align-items:center; justify-content:center; color:#555; flex-direction:column;">
                            <i class="fas fa-mouse-pointer" style="font-size:3rem; margin-bottom:20px;"></i>
                            <p>İşlem yapmak için bir talep seçin.</p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="col-header">Sistem Terminali</div>
                    <div class="terminal" id="term">
                        > System initialized...<br>
                        > Workflow Engine: Active<br>
                        > Listening for events...
                    </div>
                </div>
            </div>
        </div>

        <div id="sorgu" class="view">
            <div class="search-box">
                <h2 style="text-align:center; color:var(--tc-yellow); margin-bottom:20px;">YASAKLI BÖLGE: İSTİHBARAT</h2>
                <input type="text" class="inp" id="src-inp" placeholder="Numara (5354653384) veya TCKN">
                <button class="btn btn-blue" style="width:100%; font-size:1.1rem;" onclick="doSearch()">SORGULA</button>
                <div id="src-res" class="res-card" style="margin-top:20px;"></div>
            </div>
        </div>

        <div id="history" class="view">
            <div style="padding:20px; overflow-y:auto;">
                <h2 style="margin-bottom:20px;">İşlem Geçmişi & Geri Bildirimler</h2>
                <table id="hist-table">
                    <thead><tr><th>ID</th><th>Birim</th><th>Sorun</th><th>Durum</th><th>Birim Notu</th><th>İşlem</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="vip" class="view"><div style="padding:20px;"><h2>VIP Listesi</h2><table id="vip-table"><thead><tr><th>ID</th><th>İsim</th><th>Paket</th><th>Harcama</th><th>Statü</th></tr></thead><tbody></tbody></table></div></div>
        <div id="corp" class="view"><div style="padding:20px;"><h2>Kurumsal Hatlar</h2><table><thead><tr><th>Firma</th><th>Hizmet</th><th>Durum</th></tr></thead><tbody><tr><td>Getir Depo</td><td>Metro Ethernet</td><td><span class="status st-done">UP</span></td></tr><tr><td>Yemeksepeti HQ</td><td>VPN Tunnel</td><td><span class="status st-wait">DOWN</span></td></tr></tbody></table></div></div>
        <div id="server" class="view"><div style="padding:20px; display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:15px;" id="srv-grid"></div></div>
        <div id="finance" class="view"><div style="padding:20px;"><h2>Canlı Tahsilat</h2><div class="terminal" id="fin-log" style="height:400px;"></div></div></div>
        <div id="fiber" class="view"><div style="padding:20px;"><h2>Fiber Haritası</h2><div style="height:400px; background:#111; border-radius:10px; position:relative;" id="map-area"></div></div></div>
        <div id="base" class="view"><div style="padding:20px;"><h2>Saha Kuleleri</h2><table id="base-table"><thead><tr><th>ID</th><th>Lokasyon</th><th>Yük</th><th>Durum</th></tr></thead><tbody></tbody></table></div></div>
        <div id="security" class="view"><div style="padding:20px;"><h2 style="color:var(--red)">Güvenlik Logları</h2><table id="sec-table"><thead><tr><th>Zaman</th><th>IP</th><th>Tehdit</th></tr></thead><tbody></tbody></table></div></div>
        <div id="hr" class="view"><div style="padding:20px;"><h2>Vardiya Listesi</h2><table><tr><td>İlhan Dugan</td><td>Yönetici</td><td style="color:var(--green)">Online</td></tr><tr><td>Ahmet Yılmaz</td><td>Tier 2</td><td style="color:var(--green)">Online</td></tr></table></div></div>

    </main>

    <div class="modal-bg" id="modal">
        <div class="modal">
            <h3 style="color:var(--tc-yellow); margin-bottom:15px;">Talebi Yönlendir</h3>
            <p id="m-desc" style="color:#888; margin-bottom:15px;"></p>
            <select id="m-dept" class="inp" style="padding:10px; margin-bottom:15px;">
                <option>Saha Operasyonları</option>
                <option>Core Network (Tier 2)</option>
                <option>Hukuk Departmanı</option>
                <option>Kurumsal Müşteri Hizmetleri</option>
                <option>Finans / İtiraz</option>
            </select>
            <textarea id="m-note" class="inp" style="height:80px; margin-bottom:15px;" placeholder="Teknik not..."></textarea>
            <div style="display:flex; gap:10px;">
                <button class="btn" style="background:#444;" onclick="closeModal()">İptal</button>
                <button class="btn btn-green" onclick="confirmRoute()">Aktar</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        <div style="font-size:1.5rem; color:var(--green);"><i class="fas fa-check-circle"></i></div>
        <div>
            <div style="font-weight:bold; font-size:0.9rem;">Birim Yanıtladı</div>
            <div id="toast-msg" style="font-size:0.8rem;"></div>
        </div>
    </div>

    <script>
        // --- 1. PROCEDURAL GENERATION ENGINE (SORUN ÜRETİM MOTORU) ---
        const devices = ["iPhone 15 Pro","Samsung S24 Ultra","Xiaomi 13T","Redmi Note 12","Superbox B618","Huawei P60","Modem ZTE H3600","Apple Watch Ultra","iPad Pro M2"];
        const locations = ["Kadıköy Rıhtım","Avrasya Tüneli","15 Temmuz Köprüsü","Beşiktaş Meydan","Metro (M4 Hattı)","Bodrum Kat","Asansör İçi","Plaza 42. Kat","Havalimanı Dış Hatlar","Otoban Gişeleri","Ev (Arka Oda)"];
        const actions = ["Netflix izlerken","Zoom toplantısında","PUBG oynarken","Instagram canlı yayında","WhatsApp görüntülü konuşurken","e-Devlet'e girerken","Dosya yüklerken","Fatura öderken","Araç kullanırken"];
        const errors = ["internet tamamen kopuyor","hız 1Mbps altına düşüyor","ping 500ms oluyor","ses robotlaşıyor","karşıya ses gitmiyor","cihaz 3G'ye düşüyor","'Servis Yok' yazıyor","DNS hatası veriyor","paketimden düşmüyor"];
        const times = ["sadece akşamları","sabah saatlerinde","yağmurlu havalarda","rastgele zamanlarda","sürekli","gece 2'den sonra"];

        const fNames = ["Ahmet","Mehmet","Can","Zeynep","Elif","Selin","Burak","Mert","Emre","Ceren","Gizem","Pelin","Oğuz","Kaan","Murat","Hakan"];
        const lNames = ["Yılmaz","Kaya","Demir","Çelik","Şahin","Yıldız","Öztürk","Aydın","Arslan","Doğan","Koç","Kurt","Polat","Çakır","Erdoğan"];

        function genIssue() {
            // Rastgele kombinasyon oluştur
            const dev = devices[Math.floor(Math.random() * devices.length)];
            const loc = locations[Math.floor(Math.random() * locations.length)];
            const act = actions[Math.floor(Math.random() * actions.length)];
            const err = errors[Math.floor(Math.random() * errors.length)];
            const time = times[Math.floor(Math.random() * times.length)];
            
            // Cümleyi kur
            const desc = `${dev} cihazımla ${loc}'da ${act}, ${err}. Bu sorun ${time} yaşanıyor.`;
            
            // Başlık türet
            let title = "Bağlantı Sorunu";
            let cat = "GSM";
            let icon = "fa-signal";

            if(desc.includes("Modem") || desc.includes("Superbox")) { cat="SOL"; icon="fa-wifi"; title="Ev İnterneti Arızası"; }
            else if(desc.includes("Fatura")) { cat="BILL"; icon="fa-file-invoice"; title="Fatura Sorunu"; }
            else if(desc.includes("ses")) { title="Ses Kalitesi"; icon="fa-phone-slash"; }
            else if(desc.includes("ping")) { title="Yüksek Gecikme"; cat="SOL"; icon="fa-gamepad"; }
            
            return { desc, title, cat, icon };
        }

        // --- GLOBAL STATE ---
        let tickets = [];
        let history = [];
        let idCounter = 11000;
        let selectedTicket = null;

        // --- INIT ---
        window.onload = () => {
            setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString(), 1000);
            
            // Başlangıç verisi
            for(let i=0; i<8; i++) addTicket();
            
            // Otomatik döngüler
            setInterval(addTicket, 4000); // Yeni talep
            setInterval(workflowLoop, 2000); // İş akışı kontrolü
            
            // Yan modüller
            initSideModules();
            
            log("Procedural Engine Started.");
            log("Workflow Manager Active.");
        };

        // --- TICKET SYSTEM ---
        function addTicket() {
            idCounter++;
            const issue = genIssue();
            const name = fNames[Math.floor(Math.random()*fNames.length)] + " " + lNames[Math.floor(Math.random()*lNames.length)];
            
            const t = {
                id: idCounter,
                ...issue,
                name: name,
                time: new Date().toLocaleTimeString(),
                ip: `10.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`
            };
            
            tickets.unshift(t);
            if(tickets.length > 50) tickets.pop();
            renderList();
        }

        function renderList() {
            const area = document.getElementById('list-area');
            area.innerHTML = "";
            document.getElementById('cnt-ticket').innerText = tickets.length;
            
            tickets.forEach(t => {
                const div = document.createElement('div');
                div.className = `ticket ${selectedTicket && selectedTicket.id === t.id ? 'selected' : ''}`;
                div.onclick = () => selectTicket(t);
                div.innerHTML = `
                    <div class="t-row"><span>#TRK-${t.id}</span><span>${t.time}</span></div>
                    <div class="t-title">${t.title}</div>
                    <div class="t-row" style="margin-top:2px"><i class="fas ${t.icon}"></i> ${t.name} • ${t.cat}</div>
                `;
                area.appendChild(div);
            });
        }

        function selectTicket(t) {
            selectedTicket = t;
            renderList();
            document.getElementById('det-id').innerText = "#TRK-" + t.id;
            
            const area = document.getElementById('detail-area');
            area.innerHTML = `
                <div class="detail-content">
                    <div style="background:rgba(0,79,159,0.1); border-left:4px solid var(--tc-blue); padding:15px; margin-bottom:15px; font-style:italic; color:#ddd;">
                        "${t.desc}"
                    </div>
                    
                    <div style="margin-bottom:15px;">
                        <div class="lbl" style="font-weight:bold; margin-bottom:5px; color:var(--tc-yellow);">CANLI MÜDAHALE ARAÇLARI</div>
                        <div class="tools-grid">
                            <div class="tool-btn" onclick="runTool('Hat Reset')"><i class="fas fa-sync"></i><br>Hat Reset</div>
                            <div class="tool-btn" onclick="runTool('Port Kontrol')"><i class="fas fa-ethernet"></i><br>Port Check</div>
                            <div class="tool-btn" onclick="runTool('Sinyal Boost')"><i class="fas fa-signal"></i><br>Sinyal Güç</div>
                        </div>
                    </div>

                    <div class="info-grid">
                        <div class="info-box"><span class="lbl">Abone</span><span class="val">${t.name}</span></div>
                        <div class="info-box"><span class="lbl">Kategori</span><span class="val">${t.cat}</span></div>
                        <div class="info-box"><span class="lbl">IP Adresi</span><span class="val">${t.ip}</span></div>
                        <div class="info-box"><span class="lbl">Sinyal</span><span class="val" style="color:var(--green)">-85 dBm (İyi)</span></div>
                    </div>
                </div>
                <div class="actions">
                    <button class="btn btn-blue" onclick="openModal()">YÖNLENDİR</button>
                    <button class="btn btn-green" onclick="resolve()">ÇÖZÜLDÜ</button>
                </div>
            `;
        }

        function runTool(name) {
            log(`Executing: ${name} on #${selectedTicket.id}...`);
            setTimeout(() => log(`> ${name}: SUCCESS [Code: 200]`), 800);
        }

        // --- WORKFLOW SYSTEM (THE FIX) ---
        const deptReplies = {
            "Saha Operasyonları": ["Baz istasyonu kartı değişti, sorun giderildi.", "Fiber kesiği onarıldı.", "Sinyal optimizasyonu yapıldı."],
            "Core Network (Tier 2)": ["Hız profili güncellendi.", "IP bloğu temizlendi.", "QoS ayarları düzeltildi."],
            "Finans / İtiraz": ["İade onaylandı.", "Fatura detayları mail atıldı."]
        };

        function openModal() { if(!selectedTicket)return; document.getElementById('m-desc').innerText=`#TRK-${selectedTicket.id} nolu talep için işlem yapılıyor.`; document.getElementById('modal').style.display='flex'; }
        function closeModal() { document.getElementById('modal').style.display='none'; }
        
        function confirmRoute() {
            const dept = document.getElementById('m-dept').value;
            // Add to history with timestamp
            history.unshift({
                id: selectedTicket.id,
                dept: dept,
                issue: selectedTicket.title,
                status: "İşlemde", // Start as processing
                note: "-",
                reqTime: Date.now() // Track time
            });
            
            log(`Ticket #${selectedTicket.id} routed to ${dept}`);
            
            // Remove from main list
            tickets = tickets.filter(t => t.id !== selectedTicket.id);
            selectedTicket = null;
            renderList();
            document.getElementById('detail-area').innerHTML = `<div style="flex:1; display:flex; align-items:center; justify-content:center; color:var(--green); flex-direction:column;"><i class="fas fa-check-circle" style="font-size:3rem; margin-bottom:10px;"></i><p>Yönlendirildi</p></div>`;
            closeModal();
            updateHistory();
        }

        // --- THE HEARTBEAT (WORKFLOW LOOP) ---
        function workflowLoop() {
            const now = Date.now();
            let updated = false;

            history.forEach(h => {
                // 8 saniye sonra otomatik yanıtla
                if (h.status === "İşlemde" && (now - h.reqTime > 8000)) {
                    h.status = "Yanıtlandı";
                    const replies = deptReplies[h.dept] || ["İşlem tamamlandı."];
                    h.note = replies[Math.floor(Math.random() * replies.length)];
                    
                    showToast(h.dept, h.id);
                    updated = true;
                }
            });

            if(updated) updateHistory();
        }

        function updateHistory() {
            const tb = document.querySelector('#hist-table tbody');
            tb.innerHTML = "";
            let pendingCount = 0;

            history.forEach((h, idx) => {
                if(h.status !== "Tamamlandı") pendingCount++;
                
                let badge = "";
                if(h.status === "İşlemde") badge = "st-proc";
                else if(h.status === "Yanıtlandı") badge = "st-done";
                else badge = "st-wait";

                let action = "";
                if(h.status === "Yanıtlandı") {
                    action = `<button onclick="archive(${idx})" style="padding:4px 8px; background:var(--tc-blue); border:none; border-radius:4px; color:white; cursor:pointer;">Arşivle</button>`;
                } else if (h.status === "Tamamlandı") {
                    action = `<i class="fas fa-check" style="color:#555"></i>`;
                } else {
                    action = `<i class="fas fa-clock" style="color:#555"></i>`;
                }

                const row = `<tr>
                    <td>#${h.id}</td>
                    <td>${h.dept}</td>
                    <td>${h.issue}</td>
                    <td><span class="status ${badge}">${h.status}</span></td>
                    <td style="color:${h.status==='Yanıtlandı'?'var(--green)':'#777'}">${h.note}</td>
                    <td>${action}</td>
                </tr>`;
                tb.innerHTML += row;
            });
            
            const badgeEl = document.getElementById('badge-hist');
            badgeEl.innerText = pendingCount;
            badgeEl.style.display = pendingCount > 0 ? 'inline-block' : 'none';
        }

        function archive(idx) {
            history[idx].status = "Tamamlandı";
            updateHistory();
        }

        function resolve() {
            if(!selectedTicket) return;
            alert('Kayıt kapatıldı.');
            tickets = tickets.filter(t => t.id !== selectedTicket.id);
            selectedTicket = null;
            renderList();
            document.getElementById('detail-area').innerHTML = "";
        }

        // --- SORGU ---
        function doSearch() {
            const val = document.getElementById('src-inp').value.replace(/\s/g,'');
            const res = document.getElementById('src-res');
            res.style.display = 'none';
            
            if(val.length < 5) return alert("Numara giriniz");
            
            let d = {};
            if(val === "5354653384") {
                d = { n:"MEHMET DUGAN", t:"254********", dev:"Redmi 14C", loc:"İstanbul Kartal Soğanlık Yeni Mh. Eraykent Cd.", isTarget:true };
            } else {
                d = { n: fNames[0]+" "+lNames[0], t:Math.floor(Math.random()*9e10), dev:"Samsung A54", loc:"İstanbul / Şişli", isTarget:false };
            }
            
            setTimeout(() => {
                res.style.display = 'block';
                res.innerHTML = `
                    ${d.isTarget ? '<div class="target-badge">HEDEF TESPİT EDİLDİ</div>' : ''}
                    <div style="display:flex; gap:15px; align-items:center; border-bottom:1px solid var(--border); padding-bottom:15px;">
                        <div style="font-size:3rem; color:#555;"><i class="fas fa-user-circle"></i></div>
                        <div>
                            <h2 style="color:white; margin-bottom:5px;">${d.n}</h2>
                            <div style="font-family:'Consolas'; color:var(--tc-yellow); font-size:1.2rem;">${val}</div>
                        </div>
                    </div>
                    <div class="info-grid">
                        <div class="info-box"><span class="lbl">TCKN</span><span class="val">${d.t}</span></div>
                        <div class="info-box"><span class="lbl">Cihaz</span><span class="val">${d.dev}</span></div>
                        <div class="info-box" style="grid-column:span 2; border-color:${d.isTarget?'var(--red)':'var(--border)'}"><span class="lbl">Adres</span><span class="val" style="color:${d.isTarget?'var(--red)':'white'}">${d.loc}</span></div>
                    </div>
                `;
            }, 800);
        }

        // --- UTILS ---
        function nav(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.m-item').forEach(m => m.classList.remove('active'));
            el.classList.add('active');
            const titles = {'dash':'Canlı Arıza', 'history':'Geçmiş', 'sorgu':'İstihbarat', 'vip':'VIP', 'corp':'Kurumsal', 'server':'Sunucu', 'fiber':'Fiber', 'base':'Kuleler', 'hr':'İK', 'finance':'Finans', 'security':'Güvenlik'};
            document.getElementById('pg-title').innerHTML = `<i class="fas fa-th-large"></i> ${titles[id]}`;
        }
        
        function log(m) { const t=document.getElementById('term'); t.innerHTML+=`<div class="log-entry">> ${m}</div>`; t.scrollTop=t.scrollHeight; }
        function showToast(dept, id) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerHTML = `<strong>${dept}</strong><br>#TRK-${id} talebini yanıtladı.`;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 5000);
        }

        // --- SIDE MODULES INIT ---
        function initSideModules() {
            // VIP
            const vt = document.querySelector('#vip-table tbody');
            for(let i=0;i<10;i++) vt.innerHTML += `<tr><td>${100+i}</td><td>${fNames[i]} ${lNames[i]}</td><td>Platinum 100GB</td><td>${(Math.random()*5000).toFixed(2)} TL</td><td><span class="status st-done">VIP</span></td></tr>`;
            
            // Server
            const sg = document.getElementById('srv-grid');
            for(let i=1;i<=12;i++) sg.innerHTML += `<div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:5px;"><div style="color:#777; font-size:0.8rem">NODE-${i}</div><div style="height:5px; background:#333; margin-top:5px;"><div style="width:${Math.random()*100}%; background:var(--tc-blue); height:100%"></div></div></div>`;

            // Security
            const st = document.querySelector('#sec-table tbody');
            setInterval(() => {
                const r = `<tr><td>${new Date().toLocaleTimeString()}</td><td>192.168.1.${Math.floor(Math.random()*255)}</td><td style="color:var(--red)">DDoS Blocked</td></tr>`;
                st.innerHTML = r + st.innerHTML;
                if(st.children.length > 8) st.removeChild(st.lastChild);
            }, 2500);

            // Fiber Map
            const fm = document.getElementById('map-area');
            for(let i=0;i<20;i++) fm.innerHTML += `<div style="position:absolute; top:${Math.random()*90}%; left:${Math.random()*90}%; width:6px; height:6px; background:cyan; border-radius:50%; box-shadow:0 0 5px cyan;"></div>`;

            // Base Stations
            const bt = document.querySelector('#base-table tbody');
            for(let i=0;i<8;i++) bt.innerHTML += `<tr><td>IST-${900+i}</td><td>${locations[i]}</td><td>%${Math.floor(Math.random()*90)}</td><td><span class="status st-done">OK</span></td></tr>`;
            
            // Finance
            const fl = document.getElementById('fin-log');
            setInterval(() => { fl.innerHTML += `> Payment: ${Math.floor(Math.random()*1000)} TL received.<br>`; fl.scrollTop=fl.scrollHeight; }, 1500);
        }

    </script>
</body>
</html>
